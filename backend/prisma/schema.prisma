generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  GYM_STAFF
}

enum MembershipType {
  BASIC      // Acceso a gimnasios b√°sicos
  PREMIUM    // Acceso a todos los gimnasios
  SMARTFIT   // Solo SmartFit
  POWERFIT   // Solo PowerGym
  CUSTOM     // Personalizada
}

enum MembershipStatus {
  ACTIVE
  EXPIRED
  SUSPENDED
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  rut       String?  @unique
  qrCode    String?  @unique
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  checkins   CheckIn[]
  membership Membership?

  @@map("users")
}

model Gym {
  id          String   @id @default(uuid())
  name        String
  address     String
  latitude    Float
  longitude   Float
  maxCapacity Int
  description String?
  features    String[]
  imageUrl    String?
  rating      Float    @default(0)
  isActive    Boolean  @default(true)
  chain       String?  // "SmartFit", "PowerGym", etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  checkins            CheckIn[]
  membershipGyms      MembershipGym[]

  @@map("gyms")
}

model Membership {
  id        String           @id @default(uuid())
  userId    String           @unique
  type      MembershipType
  status    MembershipStatus @default(ACTIVE)
  startDate DateTime         @default(now())
  endDate   DateTime
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  user  User            @relation(fields: [userId], references: [id])
  gyms  MembershipGym[]

  @@map("memberships")
}

model MembershipGym {
  id           String @id @default(uuid())
  membershipId String
  gymId        String

  membership Membership @relation(fields: [membershipId], references: [id])
  gym        Gym        @relation(fields: [gymId], references: [id])

  @@unique([membershipId, gymId])
  @@map("membership_gyms")
}

model CheckIn {
  id         String    @id @default(uuid())
  gymId      String
  userId     String?
  checkedIn  DateTime  @default(now())
  checkedOut DateTime?
  eventId    String?   @unique

  gym  Gym   @relation(fields: [gymId], references: [id])
  user User? @relation(fields: [userId], references: [id])

  @@map("checkins")
}